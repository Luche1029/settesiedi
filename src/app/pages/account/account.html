<div class="card" style="max-width:860px; margin: 2rem auto;">
  <h2>Il mio account</h2>

  <div class="flex" style="gap:14px; align-items:center; margin:10px 0 18px;">
    <div style="
      width:84px; height:84px; border-radius:999px; overflow:hidden;
      border:3px solid var(--col-borders); background:#fff; display:grid; place-items:center;">
      <img *ngIf="avatarUrl(); else initials"
           [src]="avatarUrl()!" alt="avatar"
           style="width:100%; height:100%; object-fit:cover;" />
      <ng-template #initials>
        <span style="font-weight:900; font-size:1.2rem; color:var(--col-borders);">
          {{ (display_name() || '??').slice(0,2).toUpperCase() }}
        </span>
      </ng-template>
    </div>

    <label class="btn secondary" style="cursor:pointer; margin-left:6px;">
      Cambia avatar
      <input type="file" accept="image/*" hidden (change)="onAvatarSelected($event)" />
    </label>
  </div>


  <div class="form-row cols-3">
    <div>
      <label>Nome visualizzato</label>
      <input class="input"
             name="display_name"
             [ngModel]="display_name()"
             (ngModelChange)="display_name.set($event)" />
    </div>
    <div>
      <label>Email comunicazioni</label>
      <input class="input"
             type="email"
             name="email"
             [ngModel]="email()"
             (ngModelChange)="email.set($event)" />
    </div>
    <div>
      <label>Email PayPal</label>
      <input class="input"
             type="email"
             name="paypal_email"
             placeholder="usata per ricevere pagamenti"
             [ngModel]="paypal_email()"
             (ngModelChange)="paypal_email.set($event)" />
    </div>
  </div>

  <div class="flex" style="gap:8px; margin-top:10px;">
    <button class="btn" (click)="saveProfile()" [disabled]="loading() || !canSaveProfile()">Salva profilo</button>
  </div>

  <hr class="mt" />

  <h3 class="mt">Cambia password</h3>
  <div class="form-row cols-3">
    <div>
      <label>Password attuale <small class="muted">(opzionale)</small></label>
      <input class="input"
             type="password"
             name="old"
             [ngModel]="oldPwd()"
             (ngModelChange)="oldPwd.set($event)" />
    </div>
    <div>
      <label>Nuova password</label>
      <input class="input"
             type="password"
             name="new"
             [ngModel]="newPwd()"
             (ngModelChange)="newPwd.set($event)" />
    </div>
    <div>
      <label>Conferma</label>
      <input class="input"
             type="password"
             name="confirm"
             [ngModel]="confirm()"
             (ngModelChange)="confirm.set($event)" />
    </div>
  </div>

  <div class="flex" style="gap:8px; margin-top:10px;">
    <button class="btn" (click)="changePassword()" [disabled]="loading() || !canChangePwd()">Aggiorna password</button>
  </div>
    
  <hr class="mt" *ngIf="is_admin()"/>
  <div class="admin-menu" *ngIf="is_admin()">

    <a routerLink="/proposals/review">
        <span class="material-symbols-outlined">settings_panorama</span>
        <br>gestisci proposte
    </a>
    <a routerLink="/events/admin">
        <span class="material-symbols-outlined">settings_cinematic_blur</span>
        <br>gestisci men√π
    </a>    
  </div>

  <p class="mt" *ngIf="ok()" style="color:#2f7a3d; font-weight:700;">{{ ok() }}</p>
  <p class="mt" *ngIf="msg()" class="muted">{{ msg() }}</p>
</div>
