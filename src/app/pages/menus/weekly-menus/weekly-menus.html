<div class="card">
  <div class="flex" style="align-items:center; justify-content:space-between;">
    <h2>Menù della settimana <small class="muted">({{ weekLabel() }})</small></h2>
    <div class="flex" style="gap:8px">
      <button class="btn secondary" (click)="prevWeek()">← Settimana precedente</button>
      <button class="btn" (click)="nextWeek()">Settimana successiva →</button>
    </div>
  </div>

  <p *ngIf="message()" class="mt">{{ message() }}</p>
  <p *ngIf="loading()" class="mt muted">Caricamento…</p>

  <div class="grid mt" *ngIf="!loading()">
    <div class="event-card" *ngFor="let ev of items()">
      <div class="title">{{ ev.event_date | date:'EEEE d MMMM' }}</div>
      <div class="meta">
        <!-- Badge cliccabile -->
        <div class="badge" style="position:relative; cursor:pointer;"
            (click)="toggle(ev.id)"
            (mouseenter)="toggle(ev.id)" (mouseleave)="close()">
          Partecipanti: {{ ev.participants }}

          <!-- Popover -->
          <div *ngIf="openFor() === ev.id"
              class="card"
              style="position:absolute; left:0; top:calc(100% + 8px); z-index:20; min-width:220px; padding:10px;">
            <strong class="muted">Iscritti</strong>
            <ul style="margin:8px 0 0; padding:0 0 0 16px;">
              <li *ngFor="let n of (ev.participantsNames || namesMap()[ev.id] || [])">{{ n }}</li>
              <li *ngIf="!(ev.participantsNames?.length) && !(namesMap()[ev.id]?.length)" class="muted">Nessuno</li>
            </ul>
          </div>
        </div>

      </div>
      <p *ngIf="ev.notes" class="mt">{{ ev.notes }}</p>

      <div class="actions mt">
        <button class="btn rsvp-going" (click)="rsvp(ev, 'going')">Partecipo</button>
        <button class="btn rsvp-maybe" (click)="rsvp(ev, 'maybe')">Forse</button>
        <button class="btn rsvp-no" (click)="rsvp(ev, 'not_going')">No</button>
        <!--a class="btn secondary" [routerLink]="['/menus', ev.id]">Dettagli</a-->
      </div>
    </div>
  </div>

  <p *ngIf="!loading() && items().length === 0" class="mt muted">
    Nessun evento in questa settimana.
  </p>
</div>
