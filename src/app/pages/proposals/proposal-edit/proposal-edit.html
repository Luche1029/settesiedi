<!-- src/app/pages/proposals/proposal-edit/proposal-edit.html -->
<div class="card">
  <h2 *ngIf="isNew(); else editT">Nuova proposta</h2>
  <ng-template #editT><h2>Modifica proposta</h2></ng-template>

  <form (ngSubmit)="save()">
    <div class="form-row cols-3">
      <div>
        <label>Titolo</label>
        <input class="input"
               [ngModel]="proposal().title"
               (ngModelChange)="setProposal('title',$event)"
               name="title"
               required />
      </div>
      <div>
        <label>Data proposta</label>
        <input class="input" type="date"
               [ngModel]="proposal().proposal_date"
               (ngModelChange)="setProposal('proposal_date',$event)"
               name="proposal_date" />
      </div>
      <div>
        <label>Stato</label>
        <input class="input" [value]="proposal().status" disabled />
      </div>
    </div>

    <div class="form-row">
      <div>
        <label>Note</label>
        <textarea class="input" rows="2"
                  [ngModel]="proposal().notes"
                  (ngModelChange)="setProposal('notes',$event)"
                  name="notes"></textarea>
      </div>
    </div>

    <h3 class="mt">Piatti</h3>
    <div class="grid">
      <div class="card" *ngFor="let it of items(); let i = index">
        <div class="form-row">
          <div>
            <label>Nome</label>
            <input class="input"
                   [ngModel]="items()[i].name"
                   (ngModelChange)="setItem(i,'name',$event)"
                   name="name_{{i}}" />
          </div>
          <div>
            <label>Note</label>
            <input class="input"
                   [ngModel]="items()[i].notes"
                   (ngModelChange)="setItem(i,'notes',$event)"
                   name="notes_{{i}}" />
          </div>
        </div>
        <button type="button" class="btn ghost mt" (click)="removeRow(i)">Rimuovi</button>
      </div>
    </div>
    <button type="button" class="btn secondary mt" (click)="addRow()">+ Aggiungi piatto</button>

    <div class="flex mt" style="gap:8px">
      <button class="btn" type="submit" [disabled]="loading()">Salva</button>
      <button class="btn" type="button" (click)="submit()" [disabled]="loading()">Invia per revisione</button>
      <button class="btn danger" type="button" (click)="remove()" *ngIf="!isNew()">Elimina</button>
      <a class="btn ghost" [routerLink]="['/proposals']">Annulla</a>
      <small class="muted" *ngIf="msg()">{{ msg() }}</small>
    </div>
  </form>
</div>
